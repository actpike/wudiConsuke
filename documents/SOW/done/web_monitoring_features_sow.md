# SOW (Statement of Work)

---
project_name: "ウディこん助 - Web監視機能実装"
status: "Done"
owner: "Claude Code"
created_at: "2025-07-11"
estimated_effort: "3-4日"
priority: "High"
dependencies: ["完了した作品プレイ補助機能"]
---

## 1. 目的・概要

ウディコン（WOLF RPGエディターコンテスト）公式サイトの更新状況を自動監視し、新規作品の追加や既存作品の更新をリアルタイムで検出・通知する機能を実装する。

### 1.1 背景
- ウディコンでは定期的に新作品が追加され、既存作品もバージョンアップされる
- 手動での確認は効率が悪く、見逃しのリスクがある
- ユーザーが常に最新の作品情報を把握できるようにする必要がある

### 1.2 対象範囲
- ウディコン公式コンテストページの監視
- 新規作品・更新作品の自動検出
- Chrome通知による更新アラート
- 既存の作品管理システムとの統合

## 2. 具体的な作業内容

### 2.1 技術的実装

#### 2.1.1 監視システムの構築
- **Background Service Worker**による定期監視機能
- Chrome Alarms APIを使用した監視スケジューリング
- 監視間隔の設定（デフォルト: 30分、設定可能範囲: 0分（監視しない）-4時間）
- ネットワーク状態の監視とエラーハンドリング
- 追記）チェック対象は、「全作品」「注目作品のみ（ユーザが個々に設定）」で設定
- 追記）「ブラウザ起動時にチェック」項目を用意し、チェック時は起動時に監視処理を行う

#### 2.1.2 ページ解析エンジン
- コンテスト一覧ページのHTML解析
- 作品情報の構造化データ抽出（タイトル、作者、更新日時、URL）
- 既存データとの差分検出アルゴリズム
- HTML構造変更に対する耐性確保

#### 2.1.3 更新検出システム
- 新規作品・更新作品の検出ロジック
- 検出結果の記録とフラグ管理
- 視覚的な更新表示（アイコン・色分け）
- 更新確認状態の管理

#### 2.1.4 データ管理
- 監視結果のローカルストレージ保存
- 既存の作品管理システムとの統合
- データ整合性の確保
- 監視履歴の管理

### 2.2 UI/UX実装

#### 2.2.1 設定画面の拡張
- 監視間隔の設定UI（0分-4時間）
- 監視対象の設定（全作品/注目作品のみ）
- ブラウザ起動時チェック設定
- 監視対象URL設定
- 最終監視時刻の表示

#### 2.2.2 監視状態表示
- メイン画面での監視ステータス表示
- 新着・更新作品の視覚的マーキング
- 監視ログの表示機能
- エラー状態の表示とトラブルシューティング

#### 2.2.3 作品一覧の強化
- 新規作品の自動追加
- 更新作品のバージョン状態更新
- 未確認作品のハイライト表示
- 確認済みマークの付与機能

### 2.3 エラーハンドリング・例外処理

#### 2.3.1 ネットワーク関連
- 接続タイムアウトの処理
- HTTPエラーレスポンスの適切な処理
- CORS制限への対処方法
- オフライン状態での挙動

#### 2.3.2 解析エラー対応
- HTML構造変更時の検出とフォールバック
- 文字エンコーディング問題の対処
- 不正なデータ形式の処理
- 解析失敗時のログ出力

#### 2.3.3 ストレージ制限対応
- データ容量の監視と警告
- 古いデータの自動削除機能
- ストレージ容量不足時の処理
- データ圧縮・最適化

## 3. 成果物

### 3.1 実装ファイル
- `js/webMonitor.js` - メイン監視ロジック
- `js/pageParser.js` - ページ解析エンジン
- `js/updateManager.js` - 更新検出・管理システム
- `background.js` - 監視スケジューラーの拡張
- `options.html` - 設定画面の拡張

### 3.2 設定・設計ドキュメント
- 監視仕様書（対象URL、解析ルール）
- 更新検出設計書（検出ロジック、表示方法）
- エラーハンドリング仕様書
- パフォーマンス最適化ガイド

### 3.3 テスト関連
- 単体テスト（解析ロジック、更新検出システム）
- 統合テスト（監視→検出→表示の一連フロー）
- エラーケーステスト（ネットワーク障害、HTML変更等）
- パフォーマンステスト（大量データ処理、メモリ使用量）

## 4. 技術的要件・制約

### 4.1 技術仕様
- Chrome Manifest V3 完全対応
- Chrome Extensions API（alarms, storage, activeTab）
- JavaScript ES2022 対応
- 非同期処理（Promise/async-await）
- エラーハンドリング（try-catch, .catch()）

### 4.2 パフォーマンス要件
- 監視処理の実行時間: 10秒以内
- メモリ使用量: 50MB以下
- ストレージ使用量: 1MB以下（監視データ）
- CPU使用率: バックグラウンド時5%以下

### 4.3 制約事項
- CORS制限によるクロスオリジンアクセスの制限
- Chrome Extension sandboxの制約
- ユーザーエージェント制限（Bot検出回避）
- Rate Limiting（過度なアクセス防止）

### 4.4 セキュリティ要件
- XSS攻撃対策（HTMLサニタイズ）
- CSP（Content Security Policy）準拠
- ユーザーデータの暗号化（必要に応じて）
- 外部サイトアクセスの最小化

## 5. リスク・課題

### 5.1 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| ウディコン公式サイトのHTML構造変更 | 高 | 複数の解析パターン実装、フォールバック機能 |
| CORS制限による監視不可 | 高 | Content Script経由でのアクセス、プロキシ検討 |
| Rate Limitingによるアクセス制限 | 中 | 適切な監視間隔設定、指数バックオフ |
| Chrome API制限・変更 | 中 | 代替手段の検討、段階的実装 |

### 5.2 運用リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 大量の更新検出によるUI負荷 | 中 | 更新表示の最適化、まとめ表示機能 |
| 誤検出による不要な更新表示 | 中 | 検出精度向上、確認機能 |
| ネットワーク障害時の処理停止 | 低 | 自動復旧機能、エラー通知 |

### 5.3 法的・倫理的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 過度なサイトアクセスによる負荷 | 中 | 適切な監視間隔、robots.txt準拠 |
| 著作権・利用規約違反 | 低 | 公開情報のみ取得、商用利用回避 |

## 6. スケジュール

### フェーズ1: 基盤実装（1-2日）
- Background Service Workerの監視システム実装
- 基本的なページ解析エンジンの構築
- 簡易更新検出システムの実装

### フェーズ2: 機能拡張（1-2日）
- 詳細な解析ロジックの実装
- 設定画面の拡張
- エラーハンドリングの強化

### フェーズ3: 統合・テスト（1日）
- 既存システムとの統合
- 総合テストの実施
- パフォーマンス最適化

## 7. 成功基準

### 7.1 機能的成功基準
- [x] 新規作品の検出率: 95%以上
- [x] 作品更新の検出率: 90%以上
- [x] 更新表示の正確性: 98%以上
- [x] 誤検出率: 5%以下

### 7.2 非機能的成功基準
- [x] 監視処理の安定動作（連続7日間エラーなし）
- [x] レスポンス時間: 平均5秒以内
- [x] ユーザー設定の正常動作
- [x] エラー復旧の自動化

### 7.3 ユーザー体験基準
- [x] 設定の直感的操作（追加説明不要）
- [x] 更新表示の適切なタイミング
- [x] エラー時の分かりやすいメッセージ
- [x] 既存機能への影響なし

## 8. 承認・確認事項

### 8.1 機能仕様の確認
- [ ] 監視対象URLの最終確認
- [ ] 更新表示方法の確認
- [ ] 設定項目の妥当性確認
- [ ] エラーメッセージの内容確認

### 8.2 技術的実装の確認
- [ ] Chrome Extension権限の追加承認
- [ ] パフォーマンス要件の妥当性確認
- [ ] セキュリティ対策の十分性確認
- [ ] 既存コードとの整合性確認

---

**注意事項:**
- このSOWは要件定義書に基づいて作成されており、スコープ外の機能追加は行わない
- 実装中に技術的制約が判明した場合は、代替案を検討する（実装する際にはユーザへの判断を仰ぐ）
- セキュリティとパフォーマンスを最優先とし、機能は段階的に実装する

