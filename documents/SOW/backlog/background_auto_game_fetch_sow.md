---
title: "バックグラウンド自動作品取得機能実装"
status: "Todo"
priority: "High"
date: "2025-07-12"
estimated_hours: 4
tags: ["auto-fetch", "web-monitoring", "background-processing"]
---

# バックグラウンド自動作品取得機能実装 SOW

## プロジェクト概要

**目的:** ウディこん助Chrome拡張機能において、ユーザー操作なしでバックグラウンドからウディコンサイトの作品情報を自動取得し、作品データベースを自動更新する機能を実装する

**背景:** 
- 現在の実装は手動操作前提の不適切な設計
- Web監視機能との統合が不十分
- バックグラウンド自動化の要件が実現されていない

## 現状問題分析

### 不適切な実装内容
1. **手動操作UI**: TOPに配置された「作品追加」ボタン
2. **手動取得機能**: 「このページから取得」ボタン
3. **作品追加画面**: ユーザー操作前提の専用UI
4. **Web監視分離**: 既存のWeb監視機能との統合欠如

### 適切な要件
- Background Scriptでの自動実行
- Web監視サイクルとの統合
- 新規作品の自動検出・追加
- ユーザー操作不要の完全自動化

## スコープ・成果物

### 対象機能
1. **Background Script自動実行**: 定期的な作品情報取得
2. **Web監視統合**: 既存監視機能との統合実装
3. **自動作品追加**: 新規検出作品の自動データベース追加
4. **重複回避**: 既存作品との重複チェック・スキップ

### 削除対象
- TOPの「作品追加」ボタン
- 手動作品追加画面（add-game-view）
- 「このページから取得」機能
- 関連する手動操作UI

### 成果物
1. **統合されたWeb監視機能**: 作品取得を含む包括的監視
2. **自動作品管理システム**: Background Scriptベース
3. **設定統合**: 既存Web監視設定での制御
4. **クリーンなUI**: 手動操作要素の除去

## 実装詳細

### フェーズ1: 不適切機能の除去
- gitからの復元

### フェーズ2: Web監視統合設計（1.5時間）
**目標:** 既存Web監視機能に作品取得機能を統合

1. **webMonitor.js拡張**
   ```javascript
   class WebMonitor {
     async executeMonitoring() {
       // 既存: 更新検出
       const result = await this.detectChanges();
       
       // 新規: 作品取得・追加
       await this.autoFetchAndAddGames(result);
       
       return result;
     }
     
     async autoFetchAndAddGames(monitorResult) {
       // 新規作品の自動検出・追加処理
     }
   }
   ```

2. **Background Script統合**
   ```javascript
   // background.js - Web監視アラーム処理拡張
   async function handleWebMonitorAlarm() {
     const result = await performWebMonitorCheck();
     
     // 作品データベース自動更新
     await updateGameDatabase(result);
   }
   ```

3. **設定統合**
   - 既存Web監視設定で作品取得も制御
   - 「監視無効」時は作品取得も停止
   - 監視間隔に従った作品データベース更新

### フェーズ3: 自動作品管理実装（1時間）
**目標:** 完全自動化された作品管理システム

1. **自動検出・追加ロジック**
   ```javascript
   async function autoAddDetectedGames(works) {
     for (const work of works) {
       // 重複チェック
       const existing = await gameDataManager.getGameByNo(work.no);
       if (!existing) {
         // 自動追加
         await gameDataManager.addGame({
           ...work,
           source: 'auto_monitoring',
           addedAt: new Date().toISOString()
         });
       }
     }
   }
   ```

2. **データ品質管理**
   - 不完全な作品データの除外
   - 作品番号の正規化
   - 重複検出の精度向上

3. **統計・ログ管理**
   - 自動追加作品数の記録
   - 監視履歴での新規作品表示
   - エラー状況の適切な記録

### フェーズ4: 最終統合・テスト（0.5時間）
**目標:** 完全統合システムの動作確認

1. **統合テスト**
   - Web監視サイクル内での作品取得確認
   - Background Script自動実行確認
   - 重複回避機能確認

2. **設定確認**
   - 既存監視設定での制御確認
   - 無効化時の適切な停止確認

## 技術要件

### 必須機能
- ✅ Background Script完全自動実行
- ✅ Web監視機能との完全統合
- ✅ 新規作品自動検出・追加
- ✅ 重複回避システム
- ✅ 既存設定での統合制御

### 非機能要件
- **パフォーマンス**: 監視サイクルへの影響最小化
- **信頼性**: エラー時の適切な処理継続
- **保守性**: 既存機能への影響なし

### 制約事項
- 既存Web監視設定との完全互換性維持
- ユーザー操作なしでの完全自動化
- Chrome拡張機能制約内での実装

## テスト計画

### 自動化テスト
1. **Background Script実行テスト**
   - アラーム設定での自動実行確認
   - 作品取得・追加の自動化確認

2. **統合機能テスト**
   - Web監視と作品取得の統合動作
   - 設定変更時の適切な制御

3. **データ管理テスト**
   - 重複回避機能の確認
   - 作品データ品質の確認

## リスク・制約

### 技術リスク
- **Web監視機能影響**: 既存機能への悪影響リスク
- **パフォーマンス**: 監視サイクル重量化リスク
- **データ整合性**: 重複・欠損データリスク

### 制約事項
- Chrome拡張機能のBackground Script制限
- ウディコンサイト構造変更への対応
- ストレージ容量制限（5MB）

## 受け入れ基準

### 機能基準
- [ ] 手動操作UI完全除去
- [ ] Background Script自動実行
- [ ] Web監視統合完了
- [ ] 新規作品自動追加動作
- [ ] 重複回避機能動作

### 品質基準
- [ ] 既存Web監視機能への影響なし
- [ ] ユーザー操作不要での完全自動化
- [ ] 設定変更時の適切な制御
- [ ] エラー時の適切な処理継続

### 検証方法
1. Web監視設定有効化でのBackground Script動作確認
2. 新規作品検出時の自動追加確認
3. 重複作品スキップ動作確認
4. 設定無効化時の停止確認

## 完了条件

1. **完全自動化**: ユーザー操作なしでの作品データベース更新
2. **統合完了**: 既存Web監視機能との完全統合
3. **UI整理**: 不適切な手動操作要素の完全除去
4. **設定統合**: 既存設定での統合制御実現
5. **動作確認**: 実際のウディコンサイトでの動作検証

---

**注意事項**: この実装は既存のWeb監視機能を基盤とし、ユーザー体験を損なうことなく完全自動化を実現する。手動操作要素は一切残さず、Background Scriptによる完全自動化を徹底する。