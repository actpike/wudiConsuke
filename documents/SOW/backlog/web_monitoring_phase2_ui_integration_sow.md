# SOW (Statement of Work)

---
project_name: "ウディこん助 - Web監視機能フェーズ2: UI統合・設定拡張"
status: "Todo"
owner: "Claude Code"
created_at: "2025-07-11"
estimated_effort: "2-3日"
priority: "High"
dependencies: ["Web監視機能フェーズ1（監視基盤）"]
---

## 1. 目的・概要

完了したWeb監視基盤（フェーズ1）をベースに、ユーザーが実際に使用できる完全なWeb監視機能を実装する。設定UI、統合テスト、パフォーマンス最適化を含む。

### 1.1 背景
- フェーズ1で監視基盤（pageParser.js, webMonitor.js, updateManager.js, background.js）は完成
- 手動テスト機能により基盤機能の動作確認が可能
- 次に必要なのは実用的な設定UI、統合テスト、運用レベルの最適化

### 1.2 対象範囲
- options.htmlの監視設定UI拡張
- 自動監視の開始・停止機能
- 統合テスト（監視→検出→表示→通知の全フロー）
- エラーハンドリング強化とパフォーマンス最適化
- 監視履歴・統計情報の表示

### 1.3 フェーズ1完了事項の確認
✅ **完了済み:**
- pageParser.js: HTML解析エンジン（複数パターン対応）
- webMonitor.js: メイン監視システム（Chrome Alarms API統合）
- updateManager.js: 更新検出・通知・マーカー管理
- background.js: Background Service Worker実装
- 手動テスト機能: ポップアップからの監視実行・状態確認

## 2. 具体的な作業内容

### 2.1 設定UI拡張（options.html）

#### 2.1.1 Web監視設定セクション追加
- **監視間隔設定**: 0分（無効）〜4時間の選択UI
- **監視モード設定**: 「全作品」「注目作品のみ」「無効」
- **注目作品選択**: 個別作品の監視対象ON/OFF設定
	→追記：TOPの作品一覧の各行にcheckbox{□|☑}を追加し、ON/OFFを切り替える
- **ブラウザ起動時チェック**: 起動時監視の有効/無効
- **最終監視時刻表示**: リアルタイム更新

#### 2.1.2 通知設定セクション
- **通知有効化**: Chrome通知の ON/OFF
- **新規作品通知**: 新規作品検出時の通知制御
- **更新作品通知**: 作品更新検出時の通知制御
- **最大通知件数**: 一度に表示する通知数の制限
	→追記：表示例）新規：n件、更新：m件（No.02_謎解きカフェ事件簿 他）※"他"は、2件以上の該当が有る場合
- **通知テスト機能**: 設定確認用のテスト通知送信

#### 2.1.3 監視履歴・統計表示
- **最近の監視履歴**: 直近10回の監視結果一覧
- **統計情報**: 総監視回数、検出作品数、エラー回数
- **更新マーカー管理**: 未確認更新の一覧と一括確認機能
- **パフォーマンス情報**: メモリ使用量、実行時間

### 2.2 自動監視制御機能

#### 2.2.1 監視開始・停止制御
- **自動監視開始**: 設定に基づく定期監視のスケジューリング
- **監視停止**: アラームクリアとステータス更新
- **監視間隔変更**: リアルタイムでの間隔調整
- **監視ステータス表示**: 現在の監視状態の可視化

#### 2.2.2 エラー復旧・レジリエンス
- **自動復旧機能**: 連続エラー時の自動再試行
- **エラー詳細表示**: 技術的なエラー情報とユーザー向け説明
- **フォールバック機能**: プライマリ解析失敗時の代替手段
- **ネットワーク監視**: オフライン/オンライン状態の検出

### 2.3 ポップアップUI統合

#### 2.3.1 監視状態表示の統合
- **監視ステータスバー**: メイン画面での監視状態表示
- **更新通知バッジ**: 新規/更新作品の視覚的表示
- **クイック監視ボタン**: 手動監視の即座実行
- **設定画面へのリンク**: options.htmlへの導線

#### 2.3.2 作品リスト表示の拡張
- **新規作品マーク**: 監視で検出された新規作品の表示
- **更新作品マーク**: バージョンアップした作品の表示
- **確認済み機能**: 更新確認後のマーク解除
- **監視対象設定**: 個別作品の監視対象ON/OFF

### 2.4 統合テスト・品質保証

#### 2.4.1 フロー統合テスト
- **全フロー動作確認**: 監視→検出→表示→通知の一連動作
- **設定変更テスト**: UI設定変更の即座反映確認
- **エラーケーステスト**: 様々な障害状況での動作確認
- **負荷テスト**: 大量データ・長時間動作での安定性確認

#### 2.4.2 ユーザビリティテスト
- **設定の直感性**: 追加説明なしでの操作可能性
- **エラーメッセージ**: わかりやすいエラー表示
- **パフォーマンス**: UI応答性の確認
- **既存機能への影響**: プレイ補助機能との相互運用性

## 3. 成果物

### 3.1 実装ファイル
- `options.html` - Web監視設定UI拡張
- `js/options.js` - 設定画面ロジック（新規作成）
- `js/webMonitor.js` - UI統合機能の追加
- `background.js` - 自動監視制御の拡張
- `popup.html` - 監視状態表示の統合
- `popup.js` - 監視UI統合機能の追加
- `css/options.css` - 設定画面スタイル（新規作成）

### 3.2 テスト・ドキュメント
- **統合テスト仕様書**: 全フローテストケース
- **ユーザビリティレポート**: UI使いやすさ評価
- **パフォーマンス測定結果**: メモリ・CPU使用量データ
- **エラーハンドリング仕様**: 障害時の動作定義

### 3.3 設定・運用ガイド
- **初期設定ガイド**: 初回セットアップ手順
- **トラブルシューティング**: よくある問題と解決策
- **パフォーマンスチューニング**: 最適化設定推奨値

## 4. 技術的要件・制約

### 4.1 UI/UX要件
- **設定画面の応答性**: 設定変更の1秒以内反映
- **直感的操作**: 説明書なしでの基本操作可能
- **視覚的フィードバック**: 状態変化の明確な表示
- **エラー表示**: 技術者向け詳細＋ユーザー向け要約

### 4.2 パフォーマンス要件
- **設定画面読み込み**: 2秒以内の表示完了
- **監視開始・停止**: 1秒以内の状態変更反映
- **バックグラウンド監視**: CPU使用率5%以下維持
- **メモリ使用量**: 合計50MB以下

### 4.3 品質要件
- **統合テスト成功率**: 95%以上（エラーケース含む）
- **設定変更反映率**: 100%（UI設定とbackground動作の同期）
- **エラー回復率**: 90%以上（自動復旧機能）
- **ユーザビリティスコア**: 8/10以上

### 4.4 互換性要件
- **既存機能**: プレイ補助機能との完全互換性
- **Chrome版**: Manifest V3対応、最新Chrome版での動作
- **設定移行**: 既存options.htmlとの統合、既存設定の保持
- **データ整合性**: 新機能追加後の既存データ保護

## 5. リスク・課題

### 5.1 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| UI統合による既存機能への影響 | 高 | 段階的統合、互換性テスト |
| 設定変更の反映遅延・不整合 | 中 | リアルタイム同期機能、整合性チェック |
| バックグラウンド監視の安定性問題 | 中 | エラー監視、自動復旧機能 |
| パフォーマンス劣化 | 低 | 継続的な性能測定、最適化 |

### 5.2 UI/UX リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 設定項目の複雑化による使いにくさ | 中 | シンプルなデフォルト設定、段階的開示 |
| エラー状況の理解困難 | 中 | 平易なエラーメッセージ、解決策提示 |
| 監視状態の視認性不足 | 低 | 明確な視覚的インジケーター |

### 5.3 運用リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 大量更新時のUI負荷 | 中 | バッチ処理、進捗表示機能 |
| 設定ミスによる監視停止 | 低 | 設定検証、確認ダイアログ |
| 長時間監視でのメモリリーク | 低 | 定期的なメモリクリーンアップ |

## 6. スケジュール

### Day 1: 設定UI実装
- **午前**: options.html Web監視セクション追加
- **午後**: options.js 設定ロジック実装

### Day 2: 統合・制御機能
- **午前**: background.js 自動監視制御拡張
- **午後**: popup.js 監視状態表示統合

### Day 3: テスト・最適化
- **午前**: 統合テスト実施、バグ修正
- **午後**: パフォーマンス最適化、ドキュメント作成

## 7. 成功基準

### 7.1 機能的成功基準
- [ ] Web監視設定UIの完全動作（全設定項目の保存・読み込み）
- [ ] 自動監視の正常開始・停止（設定変更の即座反映）
- [ ] 統合フローの安定動作（監視→検出→表示→通知）
- [ ] エラー時の適切な表示・回復（自動復旧機能）

### 7.2 品質基準
- [ ] 統合テスト95%以上の成功率
- [ ] 設定変更の100%反映（UI ↔ Background同期）
- [ ] ユーザビリティスコア8/10以上
- [ ] パフォーマンス要件の達成（メモリ50MB以下、CPU5%以下）

### 7.3 ユーザー体験基準
- [ ] 初期設定の5分以内完了（平均的ユーザー）
- [ ] エラー時の理解しやすいメッセージ表示
- [ ] 既存機能への影響なし（プレイ補助機能）
- [ ] 直感的な操作（追加説明最小限）

## 8. 承認・確認事項

### 8.1 UI仕様の確認
- [ ] 設定項目の妥当性・過不足の確認
- [ ] デフォルト値の適切性確認
- [ ] エラーメッセージの内容・表現確認
- [ ] 視覚的デザインの統一性確認

### 8.2 技術実装の確認
- [ ] 既存コードとの統合方法確認
- [ ] パフォーマンス要件の妥当性確認
- [ ] エラーハンドリング仕様の十分性確認
- [ ] セキュリティ影響の確認

### 8.3 テスト範囲の確認
- [ ] 統合テストシナリオの網羅性確認
- [ ] ユーザビリティテスト方法確認
- [ ] パフォーマンステスト基準確認
- [ ] エラーケーステストの妥当性確認

---

**注意事項:**
- フェーズ1の実装済み基盤機能（pageParser.js等）は修正せず、拡張のみ行う
- 既存のプレイ補助機能との完全互換性を保持する
- 設定UIは段階的開示により複雑さを軽減する
- 全ての変更は段階的実装・テストで品質を確保する

**前提条件:**
- Web監視フェーズ1の全機能が正常動作していること
- 手動テスト機能で基盤機能の動作確認が完了していること
- 既存のoptions.htmlが正常動作していること