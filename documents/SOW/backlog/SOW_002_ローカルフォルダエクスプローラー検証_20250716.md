---
title: "ローカルフォルダエクスプローラー機能検証・実装"
sow_id: "SOW_002"
date: "2025-07-16"
status: "Todo"
priority: "High"
project: "UdiConsuke"
category: "機能検証・実装"
estimated_hours: 6
---

# SOW: ローカルフォルダエクスプローラー機能検証・実装

## 1. 背景・課題

### 現状の問題
- ウディこん助では作品管理機能は実装済みだが、ローカルフォルダ参照機能が未実装
- Geminiからローカルフォルダアクセスの技術的実装方法についてアドバイスを受領
- file://プロトコルを使用したローカルファイル・フォルダへのアクセス機能の検証が必要

### Geminiアドバイス要約
- Chrome拡張機能でローカルフォルダにアクセスするには「ファイルのURLへのアクセスを許可する」設定が必要
- content script + background script の連携によりfile://リンクのクリックを検知・処理
- chrome.tabs.updateAPIを使用してローカルファイルパスへ遷移可能

## 2. 目的・ゴール

### 主要目的
1. **技術検証**: file://プロトコルによるローカルフォルダアクセスの実装可能性確認
2. **プロトタイプ作成**: 最小限の動作する実装の作成
3. **ウディこん助統合**: 既存の作品管理機能との統合方法の検討
4. **ユーザビリティ検証**: 実際の使用感・利便性の評価

### 成功指標
- [ ] file://リンククリック検知機能の動作確認
- [ ] エクスプローラーでローカルフォルダが正常に開くことの確認
- [ ] ウディこん助UIからのシームレスなローカルフォルダアクセス
- [ ] Chrome拡張機能設定の適切なガイダンス実装

## 3. スコープ

### 対象範囲
1. **技術検証**
   - Geminiアドバイスに基づくプロトタイプ実装
   - Chrome Manifest V3での動作確認
   - 権限設定の動作検証

2. **機能実装**
   - 作品詳細画面からのローカルフォルダリンク表示
   - ワンクリックでエクスプローラー起動機能
   - 権限未設定時の適切なエラーハンドリング・ガイダンス

3. **UX改善**
   - 初回設定時のユーザーガイダンス
   - エラー時の分かりやすいメッセージ表示
   - 設定状態の可視化

### 対象外
- macOS、Linux環境での詳細検証（Windows環境を優先）
- ファイル操作（作成・削除・編集）機能
- ローカルファイルの直接表示・プレビュー機能

## 4. 要件定義

### 機能要件
1. **F001: ローカルフォルダリンク生成**
   - 作品データにローカルフォルダパスを保存・管理
   - UI上でローカルフォルダへのリンクを表示

2. **F002: file://リンク処理**
   - content scriptによるfile://リンククリック検知
   - background scriptでchrome.tabs.updateによる遷移処理

3. **F003: 権限管理・ガイダンス**
   - 「ファイルのURLへのアクセスを許可する」設定状態の検知
   - 未設定時の設定手順案内

4. **F004: エラーハンドリング**
   - 存在しないパスへのアクセス時の適切なエラー表示
   - 権限不足時の分かりやすいガイダンス

### 非機能要件
1. **NF001: パフォーマンス**
   - ローカルフォルダアクセス時の応答時間: 2秒以内

2. **NF002: セキュリティ**
   - 不正なファイルパスへのアクセス防止
   - ユーザーの明示的な許可のもとでのみ動作

3. **NF003: 互換性**
   - Chrome拡張機能Manifest V3準拠
   - Windows 10/11環境での動作保証

## 5. 技術仕様

### アーキテクチャ
```
[UI (popup.html)] → [navigation.js] → [dataManager.js]
         ↓
[content.js] → [background.js] → [chrome.tabs.update]
         ↓
[Windows Explorer起動]
```

### 実装ファイル
1. **manifest.json**: tabs権限、content script設定の追加
2. **content.js**: file://リンククリック検知処理の追加
3. **background.js**: ローカルフォルダ遷移処理の追加
4. **navigation.js**: ローカルフォルダリンクUI実装
5. **dataManager.js**: ローカルフォルダパス管理機能

### データ構造
```javascript
// 作品データにローカルフォルダパス項目を追加
gameData = {
  // ... 既存項目
  localFolderPath: "file:///C:/Games/WolfRPG/MyGame/"  // 新規追加
}
```

## 6. 実装計画

### Phase 1: 技術検証（2時間）
1. **プロトタイプ作成**
   - Geminiアドバイスに基づく最小限実装
   - 独立したテスト用Chrome拡張機能作成
   - file://リンク処理の動作確認

2. **権限・設定検証**
   - 「ファイルのURLへのアクセスを許可する」設定テスト
   - エラーパターンの動作確認

### Phase 2: ウディこん助統合（3時間）
1. **既存コード修正**
   - manifest.json権限追加
   - content.js、background.jsへの機能追加
   - dataManager.jsのデータ構造拡張

2. **UI実装**
   - 作品詳細画面にローカルフォルダリンク追加
   - フォルダパス入力・編集機能
   - リンクボタンの実装

### Phase 3: UX改善・テスト（1時間）
1. **ユーザーガイダンス実装**
   - 初回設定時の案内画面
   - 権限確認・設定手順の表示

2. **動作テスト**
   - 各種シナリオでの動作確認
   - エラーハンドリングテスト

## 7. 成果物

### 主要成果物
1. **プロトタイプChrome拡張機能**
   - 技術検証用の独立実装
   - 動作確認レポート

2. **ウディこん助機能拡張**
   - ローカルフォルダアクセス機能統合
   - UI/UX改善

3. **ドキュメント**
   - 実装手順書
   - ユーザー向け設定ガイド
   - 技術的制約・注意事項まとめ

### 副次成果物
1. **テストデータ**
   - 動作確認用のファイル・フォルダ構成
   - エラーケース検証データ

## 8. リスク・制約事項

### 技術的リスク
1. **R001: Chrome拡張機能制約**
   - file://プロトコルアクセスがChrome更新により制限される可能性
   - 代替手段: Electron等のデスクトップアプリ化検討

2. **R002: OS依存性**
   - Windows以外でのパス形式・動作差異
   - 代替手段: OS判定による条件分岐実装

### ユーザビリティリスク
1. **R003: 設定複雑性**
   - ユーザーが権限設定を理解・実行できない可能性
   - 代替手段: 詳細な設定ガイド・動画説明の提供

## 9. 品質基準

### 動作確認項目
1. **基本動作**
   - [ ] ローカルフォルダリンクのクリックでエクスプローラーが起動
   - [ ] 存在しないパスアクセス時の適切なエラー表示
   - [ ] 権限未設定時のガイダンス表示

2. **統合性**
   - [ ] 既存の作品管理機能への影響なし
   - [ ] データ保存・読み込みの正常動作
   - [ ] UI表示の整合性

3. **ユーザビリティ**
   - [ ] 初回設定の分かりやすさ
   - [ ] エラーメッセージの明確性

## 10. 完了条件

### 必須条件
1. プロトタイプでのfile://リンク処理動作確認
2. ウディこん助へのローカルフォルダ機能統合完了
3. 権限設定ガイダンス実装完了
4. 基本的な動作テスト完了

### 理想条件
1. 複数OS環境での動作確認
2. 詳細なユーザーマニュアル作成
3. エラーケース対応の網羅的実装

---

**作成者**: Claude  
**レビュー状況**: 未レビュー  
**関連ドキュメント**: documents/tmp/41_Gemini_ローカルフォルダ参照.txt