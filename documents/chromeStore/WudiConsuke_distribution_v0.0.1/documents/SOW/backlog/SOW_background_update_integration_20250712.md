# SOW: バックグラウンド更新結果の作品一覧統合機能

---
date: 2025-07-12
status: Todo
category: Web監視機能
priority: High
estimated_effort: 1-2時間
---

## 概要
バックグラウンド更新で正常に取得できた作品情報を、TOP画面の作品一覧に反映させる機能を実装する。現在は情報取得のみ完了しているが、実際のデータベース登録・画面反映が未完了のため、テスト用として「sampleNo7」での登録機能を実装する。

## 背景・経緯
- バックグラウンド更新機能で作品情報取得が正常動作確認完了
- 文字エンコーディング問題解決済み（Shift_JIS対応）
- 取得情報：タイトル「片道勇者（ｴﾝﾄﾘｰ見本）」、作者「SmokingWOLF」、更新日時「[6/24]」
- 現在は情報取得のみで、TOP画面への反映が未実装
- テスト目的で既存No.1への更新ではなく、新規sampleNo7として登録要望

## 要件定義

### 機能要件
1. **バックグラウンド更新結果のデータベース統合**
   - 取得した作品情報をgameDataManagerに登録
   - sampleNo7として新規作品登録（テスト用）
   - 重複チェック・データ整合性確保

2. **作品一覧への自動反映**
   - バックグラウンド更新完了後、TOP画面リスト自動更新
   - 新規追加作品の視覚的ハイライト表示
   - 正しい作品情報（No、タイトル、作者、更新日時）の表示確認

3. **データフォーマット統合**
   - 取得情報の既存データ形式への変換
   - 不足項目のデフォルト値設定
   - 評価・感想項目の初期化

4. **ユーザビリティ向上**
   - 登録完了の視覚的フィードバック
   - 新規追加作品の明確な識別表示
   - エラー時の適切なメッセージ表示

### 非機能要件
- 既存データとの完全な互換性維持
- データベース整合性確保
- UI応答性確保（遅延なしでの画面更新）

## 技術仕様

### 取得済み情報項目
バックグラウンド更新で正常取得中：
- **作品番号**: "1" （→ sampleNo7に変更）
- **タイトル**: "片道勇者（ｴﾝﾄﾘｰ見本）"
- **作者**: "SmokingWOLF"  
- **更新日時**: "[6/24]"
- **URL**: "https://silversecond.com/WolfRPGEditor/Contest/entry.shtml#1"

### データ変換仕様
```javascript
// 取得データ → gameDataManager形式
const newGameData = {
  no: "7",  // sampleNo7として固定
  title: workData.title,           // "片道勇者（ｴﾝﾄﾘｰ見本）"
  author: workData.author,         // "SmokingWOLF"
  genre: "その他",                 // デフォルト値
  description: "",                 // 空文字
  wodicon_url: workData.url,       // entry.shtml#1
  version: workData.version,       // "[6/24]"
  lastUpdate: workData.lastUpdate, // 更新日時
  source: "background_update",     // 取得ソース識別
  // 評価・感想は初期値
  rating: { 熱中度: 1, 斬新さ: 1, 物語性: 1, 画像音声: 1, 遊びやすさ: 1, その他: 1, total: 6 },
  review: "",
  is_played: false,
  version_status: "new"
};
```

### 修正対象ファイル
1. **js/webMonitor.js**
   - processChanges()メソッド修正
   - 新規作品をsampleNo7として強制登録

2. **js/dataManager.js** 
   - sampleNo7専用登録メソッド追加（既存データとの競合回避）

3. **js/popup.js**
   - バックグラウンド更新完了後のリスト更新強化
   - 新規追加作品のハイライト表示機能

4. **css/popup.css**
   - 新規追加作品の視覚的ハイライト用スタイル

## 実装手順

### Phase 1: データ統合機能実装（45分）
- webMonitor.jsのprocessChanges()修正
- 取得データをsampleNo7として登録する専用ロジック
- 重複チェック・エラーハンドリング強化

### Phase 2: 画面反映機能実装（30分）
- popup.jsでのリスト更新自動化
- 新規追加作品のハイライト表示
- 視覚的フィードバック改善

### Phase 3: UI強化・テスト（15分）
- CSSでハイライトスタイル追加
- 統合テスト・動作確認
- エラーケース検証

## 成果物

### 必須成果物
- sampleNo7での新規作品自動登録機能
- TOP画面への自動反映・ハイライト表示
- 完全なデータ統合・整合性確保
- 動作確認テスト結果

### 検証基準
- バックグラウンド更新→sampleNo7登録→画面反映の完全な流れ
- 正確な作品情報表示（タイトル、作者、更新日時）
- 既存データとの競合なし・整合性維持
- ユーザビリティ向上（視覚的フィードバック）

## リスク・注意事項

### 技術リスク
- 既存sampleNo7データとの競合可能性
- データフォーマット変換時の情報欠損
- 画面更新タイミングの整合性

### 対応策
- 既存No.7データの事前チェック・上書き確認
- 必須項目の適切なデフォルト値設定
- 非同期処理の適切な順序制御

## データフロー
```
バックグラウンド更新
  ↓ 
作品情報取得完了
  ↓
webMonitor.processChanges()
  ↓
sampleNo7として強制登録
  ↓  
gameDataManager.addGame()
  ↓
popup.js リスト更新
  ↓
TOP画面反映・ハイライト表示
```

## スケジュール
- データ統合機能実装: 0.75時間
- 画面反映機能実装: 0.5時間  
- UI強化・テスト: 0.25時間

**合計見積工数: 1.5時間**

## 補足事項
- sampleNo7は開発・テスト専用（本番では適切な番号管理が必要）
- 実装完了後、実際のNo.1更新への切り替えも容易
- 取得情報の品質は既に確認済みのため、統合作業に集中可能